project(kcm_grub2)
set(KCM_GRUB2_VERSION_MAJOR "0")
set(KCM_GRUB2_VERSION_MINOR "3")
set(KCM_GRUB2_VERSION_PATCH "5")
set(KCM_GRUB2_VERSION "${KCM_GRUB2_VERSION_MAJOR}.${KCM_GRUB2_VERSION_MINOR}.${KCM_GRUB2_VERSION_PATCH}")
find_package(KDE4 REQUIRED)
option(WITH_ImageMagick "Search for ImageMagick package" ON)
if (WITH_ImageMagick)
    find_package(ImageMagick COMPONENTS Magick++)
endif (WITH_ImageMagick)
if (ImageMagick_Magick++_FOUND)
    set(HAVE_IMAGEMAGICK 1)
else (ImageMagick_Magick++_FOUND)
    set(HAVE_IMAGEMAGICK 0)
endif(ImageMagick_Magick++_FOUND)
configure_file(config.h.cmake ${CMAKE_CURRENT_BINARY_DIR}/src/config.h)

add_subdirectory(cfg)
add_subdirectory(other)
add_subdirectory(src)

set(CPACK_SOURCE_PACKAGE_FILE_NAME "${CMAKE_PROJECT_NAME}-${KCM_GRUB2_VERSION}")
set(CPACK_SOURCE_IGNORE_FILES "/\\\\..*$;kdev4$;${CPACK_SOURCE_IGNORE_FILES}")
set(CPACK_SOURCE_GENERATOR "TBZ2")

set(CPACK_PACKAGE_NAME "kcm-grub2")
set(CPACK_PACKAGE_DESCRIPTION "GRUB2 Bootloader Editor")
set(CPACK_PACKAGE_DESCRIPTION_SUMMARY "A KCModule for configuring the GRUB2 bootloader")
SET(CPACK_PACKAGE_VERSION_MAJOR ${KCM_GRUB2_VERSION_MAJOR})
SET(CPACK_PACKAGE_VERSION_MINOR ${KCM_GRUB2_VERSION_MINOR})
SET(CPACK_PACKAGE_VERSION_PATCH ${KCM_GRUB2_VERSION_PATCH})
set(CPACK_PACKAGE_VERSION "${CPACK_PACKAGE_VERSION_MAJOR}.${CPACK_PACKAGE_VERSION_MINOR}.${CPACK_PACKAGE_VERSION_PATCH}")
set(CPACK_PACKAGE_FILE_NAME "${CPACK_PACKAGE_NAME}-${CPACK_PACKAGE_VERSION}")
set(CPACK_PACKAGE_CONTACT "Konstantinos Smanis <konstantinos.smanis@gmail.com>")
set(CPACK_GENERATOR "DEB")

set(DEBIAN_DEPS "kdebase-runtime (>= 4:4.4.0), grub-common")
if (WITH_ImageMagick)
    set(CPACK_DEBIAN_PACKAGE_DEPENDS "${DEBIAN_DEPS}, libmagick++3")
else (WITH_ImageMagick)
    set(CPACK_DEBIAN_PACKAGE_DEPENDS ${DEBIAN_DEPS})
endif (WITH_ImageMagick)
set(CPACK_DEBIAN_PACKAGE_SECTION "KDE")
set(CPACK_DEBIAN_ARCHITECTURE ${CMAKE_SYSTEM_PROCESSOR})

include(InstallRequiredSystemLibraries)
include(CPack)
